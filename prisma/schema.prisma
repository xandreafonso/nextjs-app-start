generator client {
    provider      = "prisma-client-js"
    output        = "../generated/prisma"
    binaryTargets = ["native", "windows", "linux-musl-openssl-3.0.x"]
}

generator json {
    provider = "prisma-json-types-generator"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

model User {
    id            String    @id
    name          String
    email         String
    emailVerified Boolean   @default(false)
    image         String?
    createdAt     DateTime  @default(now())
    updatedAt     DateTime  @default(now()) @updatedAt
    sessions      Session[]
    accounts      Account[]

    role       String?
    banned     Boolean?  @default(false)
    banReason  String?
    banExpires DateTime?

    @@unique([email])
}

model Session {
    id        String   @id
    expiresAt DateTime
    token     String
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
    ipAddress String?
    userAgent String?
    userId    String
    user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

    impersonatedBy String?

    @@unique([token])
}

model Account {
    id                    String    @id
    accountId             String
    providerId            String
    userId                String
    user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
    accessToken           String?
    refreshToken          String?
    idToken               String?
    accessTokenExpiresAt  DateTime?
    refreshTokenExpiresAt DateTime?
    scope                 String?
    password              String?
    createdAt             DateTime  @default(now())
    updatedAt             DateTime  @updatedAt
}

model Verification {
    id         String   @id
    identifier String
    value      String
    expiresAt  DateTime
    createdAt  DateTime @default(now())
    updatedAt  DateTime @default(now()) @updatedAt
}

model Workspace {
    id        String   @id @default(uuid())
    createdAt DateTime @default(now())
    updatedAt DateTime @default(now()) @updatedAt

    name String
    slug String
}

model Provider {
    id        String   @id @default(uuid())
    createdAt DateTime @default(now())
    updatedAt DateTime @default(now()) @updatedAt

    name        String
    description String?
    icon        String?

    type String

    schema Json // [ { name: 'client_id', label: 'Client ID', type: 'text', component: 'input', required: true }, { ..., type: 'select', options: ['A', 'B', 'C'] } ]

    credentials Credential[]
}

model Credential {
    id        String   @id @default(uuid())
    createdAt DateTime @default(now())
    updatedAt DateTime @default(now()) @updatedAt

    providerId String
    provider   Provider @relation(fields: [providerId], references: [id], onDelete: Cascade)

    name        String
    description String?

    config Json
}
